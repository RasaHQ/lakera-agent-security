flows:
  search_cars:
    description: helps users find a car based on their preferences. Also trigger this flow if a user rejects a previously proposed car or is providing alternative search criteria.
    persisted_slots:
      - car_type
      - new_or_used
      - price_range_min
      - price_range_max
      - car_model
      - exclude_keywords
    steps:
      - collect: car_model
        description: The specific car model the user is looking for (e.g., civic, pilot, camry). Only fill if user provides an actual, real-world car model.
        next:
          - if: not slots.car_model
            then:
              - collect: car_type
                description: The type of car the user is looking for (e.g., SUV, Sedan, EV). Take one of the allowed values of the slot that's closest to what the user asked for.
                next: "new_or_used"
          - else: "new_or_used"
      - id: "new_or_used"
        collect: new_or_used
        description: Whether the user wants a new or used car.
      - collect: price_range_min
        description: The minimum price for the car. Set the value to a valid float.
      - collect: price_range_max
        description: The maximum price for the car. Set the value to a valid float
      - collect: exclude_keywords
        description: Keywords to exclude from car search, separated by spaces. If user rejects the suggested car with phrases like 'anything else', 'show me something different', 'not that one', extract keywords from the previously shown car model or mentioned brands/models they don't want.
      - action: action_search_cars
        next:
          - if: not slots.chosen_car_model
            then:
              - action: utter_no_matches_found
                next: END
          - else:
              - action: utter_matching_cars
                next: END
